#!/usr/bin/env ruby

$: << "/home/matthew/src/citrus/lib"

$: << File.join(File.dirname(File.dirname(__FILE__)), "lib")

require 'rasp'

filename = File.exist?(ARGV.first) ? ARGV.shift : 't/math.vbs'
parse = Rasp::Parser.parse(File.read(filename), :consume => true)
#puts parse.dump

parse.value.graph if ARGV.grep /^--graph$/
#p parse.value

old_debug, $DEBUG = $DEBUG, ARGV.grep(/^--decode$/)
begin
  compiled = Rasp::Compiler.new.compile(parse.value, filename)
ensure
  $DEBUG = old_debug
end

compiled.call if ARGV.grep /^--run$/

